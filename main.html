<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bokeh Plot</title>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.min.js"></script>
    <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
  </head>
  <body>
    <div class="bk-root" id="05c80891-2fe3-470f-bf64-336d98455bd8" data-root-id="1062"></div>
  
    <script type="application/json" id="1195">
      {"d5c64392-bc6d-4f81-8f78-fd2fb58df157":{"defs":[],"roots":{"references":[{"attributes":{"height":20,"text":"Check if you want to type your own parameters values. ","width":200},"id":"1048","type":"PreText"},{"attributes":{},"id":"1072","type":"Selection"},{"attributes":{},"id":"1067","type":"AllLabels"},{"attributes":{"title":"h_target","value":"default"},"id":"1051","type":"TextInput"},{"attributes":{"title":"t_p_input","value":"default"},"id":"1055","type":"TextInput"},{"attributes":{"title":"u_n_input","value":"default"},"id":"1053","type":"TextInput"},{"attributes":{},"id":"1069","type":"BasicTickFormatter"},{"attributes":{"title":"t_i_input","value":"default"},"id":"1056","type":"TextInput"},{"attributes":{"title":"t_d_input","value":"default"},"id":"1057","type":"TextInput"},{"attributes":{"children":[{"id":"1040"},{"id":"1041"},{"id":"1042"},{"id":"1043"},{"id":"1044"},{"id":"1045"},{"id":"1046"}]},"id":"1058","type":"Column"},{"attributes":{},"id":"1070","type":"AllLabels"},{"attributes":{"children":[{"id":"1051"},{"id":"1052"},{"id":"1053"},{"id":"1054"},{"id":"1055"},{"id":"1056"},{"id":"1057"}]},"id":"1059","type":"Column"},{"attributes":{"code":"\n        for(let i = 0; i &lt; this.labels.length; i++) {\n            if(this.active.includes(i)) {\n                console.log(this.labels[i] + ' active')\n            } else {\n                console.log(this.labels[i] + ' not active')\n            }\n\n        }\n        console.log('checkbox_group: active=' + this.active, this.toString())\n    "},"id":"1050","type":"CustomJS"},{"attributes":{"end":600,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":300,"step":300,"title":"T_p","value":300},"id":"1044","type":"Slider"},{"attributes":{},"id":"1066","type":"BasicTickFormatter"},{"attributes":{"below":[{"id":"1012"}],"center":[{"id":"1015"},{"id":"1019"}],"height":400,"left":[{"id":"1016"}],"renderers":[{"id":"1038"}],"title":{"id":"1063"},"toolbar":{"id":"1027"},"width":400,"x_range":{"id":"1004"},"x_scale":{"id":"1008"},"y_range":{"id":"1006"},"y_scale":{"id":"1010"}},"id":"1003","subtype":"Figure","type":"Plot"},{"attributes":{"coordinates":null,"formatter":{"id":"1069"},"group":null,"major_label_policy":{"id":"1070"},"ticker":{"id":"1013"}},"id":"1012","type":"LinearAxis"},{"attributes":{"end":30,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":15,"title":"h_target","value":25},"id":"1040","type":"Slider"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{"end":50,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":0,"step":0.1,"title":"h_0","value":4},"id":"1041","type":"Slider"},{"attributes":{"children":[{"id":"1049"},{"id":"1059"}]},"id":"1060","type":"Row"},{"attributes":{"children":[{"id":"1048"},{"id":"1060"}]},"id":"1061","type":"Column"},{"attributes":{"line_alpha":0.6,"line_color":"#1f77b4","line_width":3,"x":{"field":"t"},"y":{"field":"h"}},"id":"1035","type":"Line"},{"attributes":{},"id":"1013","type":"BasicTicker"},{"attributes":{"coordinates":null,"formatter":{"id":"1066"},"group":null,"major_label_policy":{"id":"1067"},"ticker":{"id":"1017"}},"id":"1016","type":"LinearAxis"},{"attributes":{"children":[{"id":"1003"},{"id":"1058"},{"id":"1061"}]},"id":"1062","type":"Row"},{"attributes":{},"id":"1025","type":"HelpTool"},{"attributes":{"axis":{"id":"1012"},"coordinates":null,"group":null,"ticker":null},"id":"1015","type":"Grid"},{"attributes":{"axis":{"id":"1016"},"coordinates":null,"dimension":1,"group":null,"ticker":null},"id":"1019","type":"Grid"},{"attributes":{},"id":"1017","type":"BasicTicker"},{"attributes":{"args":{"T_d":{"id":"1046"},"T_i":{"id":"1045"},"T_p":{"id":"1044"},"h_0":{"id":"1041"},"h_target":{"id":"1040"},"k_p":{"id":"1043"},"source":{"id":"1002"},"u_n":{"id":"1042"}},"code":"\n                const data = source.data;\n                const t = data['t']\n                const h = data['h']\n\n                const hTarget = h_target.value;\n                const Tsim = 86400;\n                const h0 = h_0.value;\n                const Tp = T_p.value;\n                const Ti = T_i.value;\n                const Td = T_d.value;\n                const kp = k_p.value;\n                let u_n_list = [u_n.value];\n                const h_max = 30;\n                const A = 1.2;\n                const B = 1.005;\n\n                h[0] = h0;\n                h[1] = h0;\n\n                let N = parseInt( Tsim / Tp )\n                let e_0 = hTarget - h[0]\n                let e_list = [e_0]\n\n                for (let i = 1; i &lt; N; i++) {\n                    e_list.push(hTarget - h[i])\n                    let regulation_error_sum = 0\n                    for (let k = 0; k &lt; i; k++) {\n                        regulation_error_sum += e_list[k]\n                    }\n                    u_n = kp * (e_list[i] + (Tp / Ti) * regulation_error_sum + (Td / Tp) * (e_list[i] - e_list[ i - 1 ]))\n                    u_n_list.push(u_n)\n                    let Qd = u_n\n\n                    let last_ind = i\n\n                    let h_new = T_p * A * B * Qd * e_list[i]\n\n                    if (h_new &lt; 0) {\n                        h_new = 0\n                    }   \n                    if( h_new &gt; h_max) {\n                        h_new = h_max\n                    }\n                    console.log(h_new)\n                    h[i + 1] = h_new\n                }\n\n                source.change.emit()\n            "},"id":"1047","type":"CustomJS"},{"attributes":{"end":200.0,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":0.01,"step":0.01,"title":"k_p","value":20.0},"id":"1043","type":"Slider"},{"attributes":{"source":{"id":"1002"}},"id":"1039","type":"CDSView"},{"attributes":{},"id":"1021","type":"WheelZoomTool"},{"attributes":{"title":"h_0_input:","value":"default"},"id":"1052","type":"TextInput"},{"attributes":{},"id":"1020","type":"PanTool"},{"attributes":{"overlay":{"id":"1026"}},"id":"1022","type":"BoxZoomTool"},{"attributes":{},"id":"1023","type":"SaveTool"},{"attributes":{},"id":"1010","type":"LinearScale"},{"attributes":{},"id":"1024","type":"ResetTool"},{"attributes":{"line_alpha":0.2,"line_color":"#1f77b4","line_width":3,"x":{"field":"t"},"y":{"field":"h"}},"id":"1037","type":"Line"},{"attributes":{"end":35},"id":"1006","type":"Range1d"},{"attributes":{"bottom_units":"screen","coordinates":null,"fill_alpha":0.5,"fill_color":"lightgrey","group":null,"left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","syncable":false,"top_units":"screen"},"id":"1026","type":"BoxAnnotation"},{"attributes":{"end":288},"id":"1004","type":"Range1d"},{"attributes":{"end":50,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":1,"step":0.1,"title":"T_i","value":1.5},"id":"1045","type":"Slider"},{"attributes":{"end":50,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":1,"step":0.1,"title":"T_d","value":2.5},"id":"1046","type":"Slider"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":3,"x":{"field":"t"},"y":{"field":"h"}},"id":"1036","type":"Line"},{"attributes":{"title":"k_p_input","value":"default"},"id":"1054","type":"TextInput"},{"attributes":{"data":{"h":[4.0,4.0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30,0,30],"t":{"__ndarray__":"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AAAAAAAgbEAAAAAAAEBsQAAAAAAAYGxAAAAAAACAbEAAAAAAAKBsQAAAAAAAwGxAAAAAAADgbEAAAAAAAABtQAAAAAAAIG1AAAAAAABAbUAAAAAAAGBtQAAAAAAAgG1AAAAAAACgbUAAAAAAAMBtQAAAAAAA4G1AAAAAAAAAbkAAAAAAACBuQAAAAAAAQG5AAAAAAABgbkAAAAAAAIBuQAAAAAAAoG5AAAAAAADAbkAAAAAAAOBuQAAAAAAAAG9AAAAAAAAgb0AAAAAAAEBvQAAAAAAAYG9AAAAAAACAb0AAAAAAAKBvQAAAAAAAwG9AAAAAAADgb0AAAAAAAABwQAAAAAAAEHBAAAAAAAAgcEAAAAAAADBwQAAAAAAAQHBAAAAAAABQcEAAAAAAAGBwQAAAAAAAcHBAAAAAAACAcEAAAAAAAJBwQAAAAAAAoHBAAAAAAACwcEAAAAAAAMBwQAAAAAAA0HBAAAAAAADgcEAAAAAAAPBwQAAAAAAAAHFAAAAAAAAQcUAAAAAAACBxQAAAAAAAMHFAAAAAAABAcUAAAAAAAFBxQAAAAAAAYHFAAAAAAABwcUAAAAAAAIBxQAAAAAAAkHFAAAAAAACgcUAAAAAAALBxQAAAAAAAwHFAAAAAAADQcUAAAAAAAOBxQAAAAAAA8HFAAAAAAAAAckA=","dtype":"float64","order":"little","shape":[289]}},"selected":{"id":"1072"},"selection_policy":{"id":"1071"}},"id":"1002","type":"ColumnDataSource"},{"attributes":{"end":100,"js_property_callbacks":{"change:value":[{"id":"1047"}]},"start":0,"step":0.1,"title":"u_n","value":5},"id":"1042","type":"Slider"},{"attributes":{"coordinates":null,"data_source":{"id":"1002"},"glyph":{"id":"1035"},"group":null,"hover_glyph":null,"muted_glyph":{"id":"1037"},"nonselection_glyph":{"id":"1036"},"view":{"id":"1039"}},"id":"1038","type":"GlyphRenderer"},{"attributes":{"tools":[{"id":"1020"},{"id":"1021"},{"id":"1022"},{"id":"1023"},{"id":"1024"},{"id":"1025"}]},"id":"1027","type":"Toolbar"},{"attributes":{"coordinates":null,"group":null},"id":"1063","type":"Title"},{"attributes":{"active":[0,1],"js_property_callbacks":{"change:active":[{"id":"1050"}]},"labels":["h_target","h_0","u_n","k_p","T_p","T_i","T_d"]},"id":"1049","type":"CheckboxGroup"},{"attributes":{},"id":"1071","type":"UnionRenderers"}],"root_ids":["1062"]},"title":"Bokeh Application","version":"2.4.3"}}
    </script>
    <script type="text/javascript">
      (function() {
        const fn = function() {
          Bokeh.safely(function() {
            (function(root) {
              function embed_document(root) {
              const docs_json = document.getElementById('1195').textContent;
              const render_items = [{"docid":"d5c64392-bc6d-4f81-8f78-fd2fb58df157","root_ids":["1062"],"roots":{"1062":"05c80891-2fe3-470f-bf64-336d98455bd8"}}];
              root.Bokeh.embed.embed_items(docs_json, render_items);
              }
              if (root.Bokeh !== undefined) {
                embed_document(root);
              } else {
                let attempts = 0;
                const timer = setInterval(function(root) {
                  if (root.Bokeh !== undefined) {
                    clearInterval(timer);
                    embed_document(root);
                  } else {
                    attempts++;
                    if (attempts > 100) {
                      clearInterval(timer);
                      console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                    }
                  }
                }, 10, root)
              }
            })(window);
          });
        };
        if (document.readyState != "loading") fn();
        else document.addEventListener("DOMContentLoaded", fn);
      })();
    </script>
  </body>
</html>